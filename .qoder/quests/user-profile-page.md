# User Profile & Stats Page

## Overview

The User Profile page visualizes a user's debugging journey, showcasing their daily streak, AI-generated insights about their coding patterns, and battle activity history. This feature closes the engagement loop by providing tangible evidence of progress and personalized skill analysis.

**Route**: `/profile` (authenticated users only, showing their own profile)

**Design Principle**: A "Hacker Card" aesthetic that transforms debugging data into a visual resume of skills.

## Goals

1. **Engagement Retention**: Visualize daily streak to motivate consistent practice
2. **Skill Transparency**: Surface AI-generated insights from the memory loop system
3. **Progress Visualization**: Show activity patterns similar to GitHub contribution graphs
4. **Personal Growth**: Display battle completion metrics and learning trajectory

## Page Architecture

### Layout Structure

Three-tier grid layout optimized for readability and progressive information disclosure:

**Header Section** (Identity & Core Stats)

- User avatar and display name
- Current daily streak with visual emphasis
- Max streak achieved
- Total battles completed

**Middle Section** (Neural Analysis)

- AI-generated insights from `user_memories` table
- Categorized skill observations (strengths, weaknesses, patterns)
- Chronological learning evolution

**Bottom Section** (Activity Visualization)

- Activity heatmap (365-day rolling window)
- Battle history timeline
- Completion rate metrics

### Component Hierarchy

```
/app/profile/page.tsx
├── ProfileHeader
├── NeuralLink (AI Insights)
├── ActivityHeatmap
└── BattleHistory
```

## Data Requirements

### Server Action: `getUserProfile`

Location: `/lib/actions/user-profile.ts`

**Fetches:**

1. User basic info from `users` table (id, email, name, avatarUrl, createdAt)
2. Streak data from `user_streaks` table (currentStreak, maxStreak, lastCompletedDate)
3. Recent AI insights from `user_memories` table (limit 5-10, ordered by createdAt DESC)
4. Activity aggregation from `challenge_progress` table (group by completion date, count battles)
5. Total battle count and completion metrics

**Return Type:**

```typescript
interface UserProfileData {
  user: {
    id: string;
    email: string;
    name: string | null;
    avatarUrl: string | null;
    joinedDate: Date;
  };
  streaks: {
    current: number;
    max: number;
    lastCompleted: string | null;
  };
  insights: Array<{
    id: string;
    topic: string | null;
    insight: string;
    createdAt: Date | null;
  }>;
  activity: Array<{
    date: string; // YYYY-MM-DD
    battleCount: number;
  }>;
  stats: {
    totalBattles: number;
    completedBattles: number;
    completionRate: number; // percentage
  };
}
```

### Data Aggregation Logic

**Activity Heatmap Data**:

- Query `challenge_progress` table for last 365 days
- Group by completion date (using `completedAt` timestamp converted to local date)
- Count distinct challenges per day
- Map intensity levels: 0 = no activity, 1-2 = low, 3-4 = medium, 5+ = high

**Insight Categorization**:

- Parse `user_memories.topic` field to infer category
- Fallback: Use AI classification based on insight content keywords
- Categories: "strength", "weakness", "pattern", "general"

## UI Components

### ProfileHeader Component

**Purpose**: Display user identity and top-line metrics

**Visual Elements**:

- Avatar (96x96px rounded-full, fallback to initials)
- Name or email display
- Join date ("Member since...")
- Streak visualization with flame icon and count
- Total battles solved count

**Layout**:

- Flex container, centered content
- Dark gradient background (`bg-zinc-950` to `bg-zinc-900`)
- Border accent on current streak badge

**Data Display**:
| Metric | Source | Format |
|--------|--------|--------|
| Avatar | `user.avatarUrl` | Image or generated initials |
| Name | `user.name` or `user.email` | Text (truncated if long) |
| Current Streak | `streaks.current` | Number + "day streak" |
| Max Streak | `streaks.max` | Secondary text, smaller |
| Total Solved | `stats.completedBattles` | Number + "battles solved" |

### NeuralLink Component (AI Insights)

**Purpose**: Visualize AI-generated observations about user's coding patterns

**Design Philosophy**:

- Present insights as actionable intelligence, not generic feedback
- Use visual icons to categorize insight types
- Chronological ordering (most recent first)

**Visual Structure**:

```
Card Container (border-zinc-800, bg-zinc-950/50)
├── Header
│   ├── Icon: BrainCircuit (purple accent)
│   ├── Title: "Neural Analysis"
│   └── Badge: "Generated by Socratic AI"
├── Content Area
    └── Insight List
        └── For each insight:
            ├── Type Icon (Zap/AlertTriangle/TrendingUp)
            ├── Insight Text (readable font, zinc-300)
            ├── Topic Tag (if present)
            └── Date Stamp (small, zinc-600)
```

**Icon Mapping**:

- Strength/positive pattern: `Zap` icon (yellow-400)
- Weakness/area for improvement: `AlertTriangle` icon (red-400)
- Neutral pattern/observation: `TrendingUp` icon (blue-400)

**Empty State**:

- Message: "No analysis data yet. Complete more battles to unlock insights."
- Subtle italic styling, centered

**Data Binding**:

- Source: `insights` array from `UserProfileData`
- Display limit: 5 most recent insights
- Scroll if overflows (max-height with scroll-area)

### ActivityHeatmap Component

**Purpose**: GitHub-style contribution graph showing daily battle activity

**Visual Design**:

- 365-day rolling window (approximately 53 weeks)
- Grouped by weeks (7 rows, ~52 columns)
- Each cell represents one day
- Hover tooltip shows date and battle count

**Intensity Levels** (mapped to Tailwind colors):
| Level | Battle Count | Color Class |
|-------|--------------|-------------|
| 0 | 0 battles | bg-zinc-900 |
| 1 | 1-2 battles | bg-emerald-950 |
| 2 | 3-4 battles | bg-emerald-800 |
| 3 | 5-6 battles | bg-emerald-600 |
| 4 | 7+ battles | bg-emerald-400 |

**Layout Approach**:

- Use CSS Grid or Flexbox for week columns
- Each day is a 12px x 12px square with 2px gap
- Rounded corners (rounded-sm)
- Smooth color transitions on hover

**Tooltip Implementation**:

- Use shadcn `Tooltip` component
- Display format: "X battles on MMM DD, YYYY"
- Only show tooltip on days with activity

**Accessibility**:

- ARIA label on each cell describing count and date
- Keyboard navigable (tab through days)
- Screen reader-friendly descriptions

### BattleHistory Component

**Purpose**: Chronological list of recent battle completions

**Data Source**: Query `challenge_progress` table, join with challenge metadata

**Display Structure**:

```
Card Container
├── Header: "Recent Battles"
├── List (vertical scroll, max 10 items)
    └── For each battle:
        ├── Challenge Title
        ├── Completion Date (relative time: "2 days ago")
        ├── Attempts Count
        └── Link to battle page
```

**Visual Treatment**:

- Each item in a subtle card (`bg-zinc-900/40`, border-zinc-800)
- Completion checkmark icon (emerald-500)
- Hover effect: slight scale and border brightness

## Page Flow

### Authentication Guard

**Requirement**: Page is accessible only to authenticated users

**Implementation**:

- Use Next.js middleware to check Supabase session
- Redirect unauthenticated users to home page with message
- Alternative: Server-side check in page component, show sign-in prompt

### Loading States

**Initial Load**:

- Show skeleton loaders for each section
- ProfileHeader: Shimmer effect on avatar and text blocks
- NeuralLink: 3-5 skeleton insight cards
- ActivityHeatmap: Grid of pulsing gray squares

**Error States**:

- If user data fetch fails: Display error message with retry button
- If insights fail: Show empty state, suppress error (non-critical)
- If activity data fails: Show message "Activity data unavailable"

### Data Refresh Strategy

**Frequency**: Data fetched on page load (server-side)

**Cache Behavior**:

- Profile data: Cache for 5 minutes (revalidate on navigation)
- Activity heatmap: Cache for 1 hour (low volatility)
- Insights: Cache for 10 minutes (moderate update frequency)

**Optimistic Updates**: Not required (read-only page)

## Technical Specifications

### Route Implementation

**File**: `/app/profile/page.tsx`

**Rendering**: Server Component (default)

**Data Fetching**: Async function in page component, calls `getUserProfile` server action

**Pattern**:

```
Server Component (page.tsx)
├── Async data fetch (getUserProfile)
├── Pass data to client components as props
└── Render static layout with data
```

### Database Queries

**Performance Considerations**:

- Use database indexes on `userId` and `completedAt` columns in `challenge_progress`
- Limit activity query to 365 days (WHERE clause)
- Use `COUNT(DISTINCT challengeId)` for accurate battle counts
- Join `user_memories` with `embeddings` only if semantic search is needed (not for basic display)

**Query Optimization**:

- Batch related queries using Promise.all for parallel execution
- Select only required columns (avoid SELECT \*)
- Use database views for complex aggregations if performance degrades

### Security Considerations

**Data Privacy**:

- Users can only view their own profile (no public profiles in MVP)
- Validate user ID from authenticated session matches requested profile
- Sanitize any user-generated content (name, insights text) to prevent XSS

**Database Access**:

- All queries filtered by authenticated user's ID
- Use Drizzle ORM parameterized queries (automatic SQL injection protection)
- Row-Level Security (RLS) policies in Supabase as fallback

## Styling Guidelines

### Color Palette

- Background: `bg-zinc-950` (primary), `bg-zinc-900` (secondary cards)
- Borders: `border-zinc-800` (default), `border-zinc-700` (hover)
- Text: `text-zinc-100` (primary), `text-zinc-300` (secondary), `text-zinc-500` (tertiary)
- Accents:
  - Streak: `text-orange-500` (flame), `bg-orange-500/10` (badge)
  - AI Insights: `text-purple-500` (brain icon)
  - Activity: `bg-emerald-*` gradient
  - Success: `text-emerald-500`

### Typography

- Headings: `font-extrabold`, `tracking-tight`
- Body: Default sans-serif, `leading-snug`
- Metrics: `font-mono` for numbers (streak count, battle count)
- Dates: `text-xs`, `uppercase`, `tracking-wider`

### Spacing & Layout

- Page padding: `p-8` (desktop), `p-4` (mobile)
- Section gaps: `space-y-8`
- Card padding: `p-6` (header), `p-4` (content)
- Max width: `max-w-5xl mx-auto` (consistent with existing pages)

### Responsive Breakpoints

- Mobile (< 768px): Single column, stacked sections
- Tablet (768px - 1024px): Two-column grid for stats
- Desktop (> 1024px): Three-column grid where applicable

## Interaction Patterns

### Hover States

- Insight cards: Slight border brightness (`hover:border-zinc-700`)
- Activity cells: Tooltip appears, cell scales slightly (`hover:scale-110`)
- Battle history items: Background lightens (`hover:bg-zinc-800/60`)

### Animations

- Page entrance: Fade-in with stagger effect (top to bottom)
- Skeleton loaders: Pulse animation
- Streak badge: Subtle glow effect if current streak > max streak (personal record)

### Navigation

- Back to home: Link in page header
- Battle links: Open in same tab (maintain context)
- External links (if any): Open in new tab with `rel="noopener noreferrer"`

## Future Enhancements

**Post-MVP Features** (not in scope for initial design):

1. **Public Profiles**: `/u/[username]` route with shareable links
2. **Skill Radar Chart**: Visual representation of skill areas (React, CSS, async patterns)
3. **Achievement Badges**: Unlockable icons for milestones (10-day streak, 50 battles, etc.)
4. **Comparison View**: Compare stats with platform averages
5. **Export Profile**: Download profile as PNG or PDF
6. **Customization**: User-selected theme colors or avatar frames

## Testing Considerations

**Unit Tests**:

- `getUserProfile` server action returns correct data structure
- Activity heatmap correctly maps battle counts to intensity levels
- Insight categorization logic handles edge cases (null topics, empty strings)

**Integration Tests**:

- Authenticated user can access their profile
- Unauthenticated user is redirected
- Loading states appear before data loads
- Error states display when queries fail

**Visual Regression**:

- Snapshot tests for each component
- Responsive layout at different breakpoints
- Dark mode consistency (entire app is dark-themed)

## Accessibility (A11y)

**Requirements**:

- WCAG 2.1 Level AA compliance
- Semantic HTML (proper heading hierarchy)
- ARIA labels on interactive elements
- Keyboard navigation support (tab order, focus indicators)
- Screen reader announcements for dynamic content
- Sufficient color contrast (4.5:1 minimum for text)

**Specific Implementations**:

- Activity heatmap: `role="grid"`, each cell with `aria-label`
- Insights: `role="list"` for container, `role="listitem"` for each
- Streak badge: `aria-live="polite"` if streak increments are animated
- Loading states: `aria-busy="true"` attribute

## Implementation Notes

### Component Reusability

- `ActivityHeatmap` can be extracted for use in other contexts (admin dashboard, analytics)
- `NeuralLink` is specific to profile page but uses generic card structure
- Leverage existing shadcn components: `Card`, `Badge`, `Tooltip`, `ScrollArea`

### Code Organization

**New Files**:

```
/app/profile/page.tsx                 (Server Component - main page)
/components/profile/ProfileHeader.tsx (Client Component - user info)
/components/profile/NeuralLink.tsx    (Client Component - AI insights)
/components/profile/ActivityHeatmap.tsx (Client Component - heatmap)
/components/profile/BattleHistory.tsx (Server Component - list)
/lib/actions/user-profile.ts          (Server Action - data fetching)
```

**Dependencies**:

- No new npm packages required
- Uses existing Drizzle, Supabase, and shadcn infrastructure
- Lucide icons: `BrainCircuit`, `Zap`, `AlertTriangle`, `TrendingUp`, `Flame`, `Calendar`

### Performance Targets

- Page load (FCP): < 1.5s
- Total data fetch time: < 500ms
- Heatmap render time: < 200ms (for 365 cells)
- Smooth 60fps animations

## Design Rationale

### Why "Neural Link" for AI Insights?

The term "Neural Link" bridges the technical nature of AI analysis with the user's mental model of receiving personalized guidance. It positions the AI tutor as a learning companion rather than a judge, encouraging users to view insights as growth opportunities.

### Why Activity Heatmap Over Simple List?

Visual patterns are easier to recognize than tabular data. The heatmap reveals consistency patterns (gaps in streaks, binge practice sessions) that a list cannot convey. It also leverages familiarity with GitHub's contribution graph, reducing cognitive load.

### Why Limit Insights to 5-10?

Too many insights create decision paralysis. Curating the most recent and relevant observations ensures users focus on actionable feedback. The profile page should motivate, not overwhelm.

### Why No Public Profiles in MVP?

Privacy concerns and reduced scope for initial launch. Public profiles require username system, privacy settings, and moderation considerations. Self-view profiles deliver 80% of the value with 20% of the complexity.
